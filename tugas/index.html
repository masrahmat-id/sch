<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - CBT SMP Azzahro</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background-color: #eef2f7; display: flex; flex-direction: column; min-height: 100vh; }
        .top-banner { background: linear-gradient(135deg, #1e88e5, #1565c0); height: 220px; width: 100%; display: flex; justify-content: center; align-items: center; color: white; position: absolute; top: 0; z-index: 1; }
        .header-content { display: flex; align-items: center; gap: 12px; margin-bottom: 60px; }
        .logo-puspendik { width: 60px; height: auto; }
        .header-text h1 { margin: 0; font-size: 24px; letter-spacing: 1.5px; font-weight: 800; }
        .container { position: relative; z-index: 2; margin-top: 140px; width: 90%; max-width: 360px; background: white; border-radius: 12px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); align-self: center; overflow: hidden; }
        .login-content { padding: 30px 25px; }
        .login-content h2 { margin-top: 0; color: #333; font-size: 20px; text-align: center; }
        .subtitle { color: #777; font-size: 13px; text-align: center; margin-bottom: 25px; }
        .input-group { margin-bottom: 20px; }
        .field-container { display: flex; align-items: center; border: 1px solid #ddd; border-radius: 8px; background: #fafafa; }
        .field-icon { width: 40px; display: flex; justify-content: center; opacity: 0.5; }
        input, select { border: none; outline: none; width: 100%; padding: 12px 10px 12px 0; font-size: 14px; background: transparent; }
        .btn-login { background: #1e88e5; color: white; width: 100%; border: none; padding: 14px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.3s; }
        .btn-login:hover { background: #1565c0; transform: translateY(-1px); }
        .login-footer { background-color: #f1f3f5; padding: 15px; text-align: center; font-size: 11px; color: #999; }
    </style>
</head>
<body>

<div class="top-banner">
    <div class="header-content">
        <img src="https://github.com/masrahmat-id/absensi-barcode-online-smp-smk-azzahro/raw/main/logo-smp-azzahro.png" class="logo-puspendik">
        <div class="header-text"><h1>PUSPENDIK</h1><p>CBT Application</p></div>
    </div>
</div>

<div class="container">
    <div class="login-content">
        <h2>Selamat Datang</h2>
        <p class="subtitle">Silakan login. Nama yang sudah mengerjakan tidak dapat login kembali.</p>
        
        <div class="input-group"><div class="field-container">
            <span class="field-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg></span>
            <input type="text" id="nama" placeholder="Nama Lengkap (Huruf Kapital)">
        </div></div>

        <div class="input-group"><div class="field-container">
            <span class="field-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path></svg></span>
            <select id="kelas">
                <option value="">-- Pilih Kelas --</option>
                <option value="VII">Kelas VII</option>
                <option value="VIII">Kelas VIII</option>
                <option value="IX">Kelas IX</option>
            </select>
        </div></div>

        <div class="input-group"><div class="field-container">
            <span class="field-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777z"></path></svg></span>
            <input type="text" id="tokenInput" placeholder="Token Ujian">
        </div></div>

        <button class="btn-login" onclick="validasiLogin()">MASUK SEKARANG</button>
    </div>
    <div class="login-footer">&copy; 2026 SMP Azzahro - CBT System</div>
</div>

<script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyuRnTMO6jx38ZGpun-tkKRgp_PBTrXQ-ugfak6818HGt30HX4yFUFFyavG0ubN8Cg/exec';

    async function validasiLogin() {
        const nama = document.getElementById('nama').value.trim().toUpperCase();
        const kelas = document.getElementById('kelas').value;
        const tokenInput = document.getElementById('tokenInput').value;

        if(!nama || !kelas || !tokenInput) return alert("Lengkapi data login!");

        try {
            // 1. Cek Token
            const resToken = await fetch('token.json');
            const dataToken = await resToken.json();
            if(tokenInput !== dataToken.token_aktif) return alert("Token Salah!");

            // 2. Cek apakah nama sudah mengerjakan (API ke Google Sheets)
            const cekRes = await fetch(`${SCRIPT_URL}?action=checkStatus&nama=${nama}`);
            const status = await cekRes.text(); 

            if (status === "SUDAH_ADA") {
                alert("Maaf, Nama ini sudah mengirimkan jawaban dan dilarang login kembali!");
                return;
            }

            // 3. Set Izin Akses
            sessionStorage.setItem('Screen1.Has Permission', 'true');
            sessionStorage.setItem('userCBT', JSON.stringify({ nama, kelas, isAuth: true }));
            window.location.href = 'ujian.html';

        } catch (e) {
            alert("Terjadi kesalahan koneksi atau database.");
        }
    }
</script>
</body>
</html>
